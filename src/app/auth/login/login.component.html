<div class="login-container">
  <div class="login-box">
    <!-- Logo + encabezado -->
    <div class="brand">
      <img src="/assets/logo.svg" alt="LaComanda Logo" class="login-logo" />
      <h1 class="title">LaComanda</h1>
      <p class="tagline">Gestión ágil para restaurantes y hostelería</p>
      <button *ngIf="showInstallButton" class="pwa-btn" (click)="installPWA()">Instalar aplicación</button>
    </div>

    <!-- Card del formulario -->
    <div class="login-card">
      <form [formGroup]="loginForm" (ngSubmit)="login()">
        <div *ngIf="!loginValid" class="error-banner">Credenciales inválidas. Inténtalo de nuevo.</div>

        <!-- Selector de sucursal -->
        <div class="form-group">
          <label for="tenant">Sucursal</label>
          <div class="custom-select">
            <select id="tenant" formControlName="tenant" required>
              <option *ngFor="let tenant of tenantDefault" [ngValue]="tenant">
                {{ tenant.Sucursal }}
              </option>
            </select>
          </div>
        </div>

        <!-- Tipo de usuario -->
        <div class="form-group">
          <label for="idNivel">Tipo de usuario</label>
          <div class="custom-select">
            <select id="idNivel" formControlName="idNivel" required>
              <option *ngFor="let nivel of nivelUsuario" [value]="nivel.value">
                {{ nivel.nombreNivel }}
              </option>
            </select>
          </div>
        </div>

        <!-- Identificador único (solo si aplica) -->
        <div class="form-group" *ngIf="shouldShowIdentifierField()">
          <label for="identifier">Identificador único</label>
          <input id="identifier" type="text" formControlName="identifier" required />
        </div>

        <!-- Botón contraseña táctil -->
        <div class="password-field">
          <button type="button" class="lc-btn lc-btn-ghost" (click)="openPasswordDialog()">
            <span class="lc-btn__icon" aria-hidden="true">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                <path d="M12 2a7 7 0 0 0-7 7" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" />
                <path d="M19 9a7 7 0 0 0-7-7" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" opacity=".7" />
                <path d="M5 13a7 7 0 0 0 7 7" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" />
                <path d="M12 6a5 5 0 0 0-5 5" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" />
                <path d="M17 11a5 5 0 0 0-5-5" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" opacity=".7" />
              </svg>
            </span>
            Ingresar contraseña táctil
          </button>
        </div>

        <!-- Contraseña -->
        <div class="form-group">
          <label for="password">Contraseña</label>
          <input id="password" type="password" formControlName="password" required />
        </div>

        <!-- Botón principal -->
        <button
          type="submit"
          class="lc-btn lc-btn-primary login-button"
          [disabled]="isSubmitting || loginForm.invalid">
          <ng-container *ngIf="!isSubmitting; else loadingTpl">Entrar</ng-container>
        </button>

        <ng-template #loadingTpl>
          <span aria-busy="true">Ingresando…</span>
        </ng-template>
      </form>
    </div>

    <!-- Versión app -->
    <p class="app-version">Versión de la aplicación: {{ appVersion }}</p>
  </div>
</div>
