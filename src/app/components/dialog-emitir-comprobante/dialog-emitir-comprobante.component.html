<div class="container">
  <button mat-icon-button class="close-button" (click)="salir()">
    <mat-icon>close</mat-icon>
  </button>
  <br>
  <form [formGroup]="form">
    <div>
      <div class="form-row">

        <mat-form-field appearance="outline" class="h1-field">
          <mat-label>Tipo Documento</mat-label>
          <mat-select formControlName="idTipoDoc" name="tipoDocumento" (selectionChange)="onTipoDocumentoChange()"  required>
            <mat-option *ngFor="let item of listTipoDocumento" [value]="item.IdTipoDoc">
              {{item.Descripcion}}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline" class="serie-field">
          <mat-label>Serie</mat-label>
          <input matInput formControlName="serie" name="serie" [readonly]="!SerieEnabled">
        </mat-form-field>

        <mat-form-field appearance="outline" class="numero-field">
          <mat-label>Numero</mat-label>
          <input matInput formControlName="lblcorrelativo" name="lblcorrelativo" [readonly]="!CorrelativoEnabled">
        </mat-form-field>
      </div>

      <div formGroupName="cliente">
      <div class="form-row">
         <mat-form-field appearance="outline" class="flex-item">
          <mat-label>Tipo Documento Cliente</mat-label>
          <mat-select formControlName="tipoIdentidad" name="tipoDocumentoCliente" (selectionChange)="tipoDocumentoClienteChange()">
            <mat-option *ngFor="let item of listTipoDocumentoCliente" [value]="item.IdTipoIdentidad">
              {{item.Descripcion}}
            </mat-option>
          </mat-select>
        </mat-form-field>
        
        <mat-form-field appearance="outline" class="ruc-field">
          <mat-label>{{etiquetaCliente}}</mat-label>
          <input matInput placeholder="123..." formControlName="ruc">
          <mat-error *ngIf="form.get('cliente.ruc').hasError('length')">Debe tener {{rucLength}} caracteres.</mat-error>
          <mat-error *ngIf="form.get('cliente.ruc').hasError('required')">El campo es requerido.</mat-error>
          <mat-error *ngIf="form.get('cliente.ruc').hasError('pattern')">Debe ser un número.</mat-error>
          <mat-error *ngIf="form.get('cliente.ruc').hasError('invalidRUC')">Numero inválido.</mat-error>
          <button mat-icon-button matSuffix (click)="buscarCliente()">
            <mat-icon>search</mat-icon>
          </button>
        </mat-form-field>
      </div>

      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Cliente</mat-label>
        <input matInput formControlName="razonSocial" required>
        <mat-error *ngIf="form.get('cliente.razonSocial').hasError('required')">El campo es requerido.</mat-error>
        <mat-error *ngIf="form.get('cliente.razonSocial').hasError('invalidRazonSocial')">
          La razón social debe ser "Cliente Varios" cuando el RUC es 00000001.
        </mat-error>
      </mat-form-field>

      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Dirección</mat-label>
        <input matInput formControlName="direccion">
      </mat-form-field>

      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Correo</mat-label>
        <input matInput formControlName="correo" placeholder="pat@example.com"/>
        <mat-error *ngIf="form.get('cliente.correo').hasError('pattern')">El formato del correo es incorrecto.</mat-error>
      </mat-form-field>
    </div>
    </div>
  </form>



  <div class="d-flex align-items-center mb-3 cash-row">
    <div class="cash-buttons">
      <button class="button_azul" style="width: 80px;" (click)="SolesExacto()">Soles Exacto</button>
      <button class="button_azul" style="width: 50px;" (click)="SolesPredefinido(20)">S/. 20</button>
      <button class="button_azul" style="width: 50px;" (click)="SolesPredefinido(50)">S/. 50</button>
      <button class="button_azul" style="width: 50px;" (click)="SolesPredefinido(100)">S/. 100</button>
      <button class="button_azul" style="width: 50px;" (click)="SolesPredefinido(200)">S/. 200</button>
    </div>
    <div class="d-flex flex-column mr-3 align-buttons">
      <button class="button_azul" style="width: 100px;" (click)="obtenerSoles()">Soles</button>
      <button class="button_azul" style="width: 100px;" (click)="obtenerDolares()">Dolares</button>
    </div>
    <div class="d-flex flex-column mr-3 align-labels">
      <div class="GrupoLabel">
        <div> {{solesValue}}</div>
      </div>
      <div class="GrupoLabel">
        <div>{{dolaresValue}}</div>
      </div>
    </div>
    <div class="d-flex flex-column mr-3 align-labels">
      <div class="GrupoLabel">
        <div>{{lblcal}}</div>
      </div>
      <div class="GrupoLabel">
        <div>{{lblcambio}}</div>
      </div>
    </div>
  </div>
  <div class="tabla-container">
  <mat-table [dataSource]="dataSourcePago" class="mat-elevation-z8 mb-3">
    <ng-container matColumnDef="tarjeta">
      <mat-header-cell *matHeaderCellDef> Tarjeta </mat-header-cell>
      <mat-cell *matCellDef="let element">{{ element.Tarjeta?.Descripcion }}  </mat-cell>
      <mat-footer-cell *matFooterCellDef>
        <mat-form-field style="min-width: 200px;">
          <mat-select placeholder="Tarjeta" [(ngModel)]="nuevoRegistro.Tarjeta">
            <mat-option *ngFor="let value of listTarjeta" [value]="value">{{ value.Descripcion }}</mat-option>
          </mat-select>
        </mat-form-field>
      </mat-footer-cell>
    </ng-container>

    <ng-container matColumnDef="autorizacion">
      <mat-header-cell *matHeaderCellDef> AP </mat-header-cell>
      <mat-cell *matCellDef="let element"> {{element.Autorizacion}} </mat-cell>
      <mat-footer-cell *matFooterCellDef>
        <mat-form-field>
          <input matInput placeholder="AP" [(ngModel)]="nuevoRegistro.Autorizacion">
        </mat-form-field>
      </mat-footer-cell>
    </ng-container>

    <ng-container matColumnDef="montoPagado">
      <mat-header-cell *matHeaderCellDef> Monto </mat-header-cell>
      <mat-cell *matCellDef="let element"> {{element.MontoPagado}} </mat-cell>
      <mat-footer-cell *matFooterCellDef>
        <mat-form-field>
          <input matInput placeholder="Monto" type="number" [(ngModel)]="nuevoRegistro.MontoPagado">
        </mat-form-field>
      </mat-footer-cell>
    </ng-container>

    <ng-container matColumnDef="propina">
      <mat-header-cell *matHeaderCellDef> Propina </mat-header-cell>
      <mat-cell *matCellDef="let element"> {{element.Propina}} </mat-cell>
      <mat-footer-cell *matFooterCellDef>
        <mat-form-field>
          <input matInput placeholder="Propina" type="number" [(ngModel)]="nuevoRegistro.Propina">
        </mat-form-field>
      </mat-footer-cell>
    </ng-container>

    <ng-container matColumnDef="acciones">
      <mat-header-cell *matHeaderCellDef> Acciones </mat-header-cell>
      <mat-cell *matCellDef="let element">
        <button mat-icon-button color="warn" matTooltip="Eliminar" (click)="eliminarRegistro(element)">
          <mat-icon>remove</mat-icon>
        </button>
      </mat-cell>
      <mat-footer-cell *matFooterCellDef>
        <button mat-icon-button color="primary" matTooltip="Agregar" (click)="agregarRegistro(element)">
          <mat-icon>add</mat-icon>
        </button>
      </mat-footer-cell>
    </ng-container>

    <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>
    <mat-row *matRowDef="let row; columns: displayedColumns;"></mat-row>
    <mat-footer-row *matFooterRowDef="displayedColumns"></mat-footer-row>
  </mat-table>
</div>
  <div class="results-row d-flex justify-content-between">
    <mat-form-field appearance="outline" class="flex-grow-1 mr-3">
      <mat-label>Monto a Pagar</mat-label>
      <input matInput type="text" [(ngModel)]="lblmonto" readonly>
    </mat-form-field>
    <mat-form-field appearance="outline" class="flex-grow-1 mr-3">
      <mat-label>Tarjeta</mat-label>
      <input matInput type="text" [(ngModel)]="lblmontotarjeta" readonly>
    </mat-form-field>
    <mat-form-field appearance="outline" class="flex-grow-1 mr-3">
      <mat-label>Total Pago</mat-label>
      <input matInput type="text" [(ngModel)]="lbltotal" readonly>
    </mat-form-field>
    <mat-form-field appearance="outline" class="flex-grow-1">
      <mat-label>{{Label14}}</mat-label>
      <input matInput type="text" [(ngModel)]="lblvuelto" readonly>
    </mat-form-field>
    <div class="example-button-container">
      <a mat-fab extended (click)="cmdCobrarClick()">
        <mat-icon>payment</mat-icon>
        Cobrar
      </a>
    </div>
  </div>
</div>